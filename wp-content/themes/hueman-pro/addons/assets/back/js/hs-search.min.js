var HS_Search;jQuery(function(a){HS_Search=a.extend(GF_HS_Settings,{searching:!1,cancelled:!1,has_searched:!1,count:0,query:"",timeout:null,wrap:a(".frm_form_fields .helpscout-docs"),form:a(".frm_form_fields .helpscout-docs").closest(".frm-show-form"),field:a(".frm_form_fields .helpscout-docs").find('input[type="text"]'),onclick:"",keypress:"",results:{},performed_search:0,has_searched_enough:function(){return a.Deferred(function(){var a=this,b=function(){_.delay(function(){HS_Search.performed_search>0?a.resolve():b()},2e4)};return b(),a.promise()})}(),init:function(){HS_Search.form.find(".go-next-step").hide(),HS_Search.has_searched_enough.done(function(){HS_Search.form.find(".go-next-step").show()}),HS_Search.form.on("keypress",function(b){var c=b.which||b.keyCode;if(HS_Search.field.is(":focus"))return 13!=c||a(b.target).is('textarea,input[type="submit"],input[type="button"]')?void 0:(b.preventDefault(),!1)}),HS_Search.wrap.append('<div class="'+GF_HS_Settings.template.wrap_class+'" style="display:none;" />'),HS_Search.field.attr("autocomplete","off").on("keydown keyup change",HS_Search.search_changed)},search_changed:function(b){if(!_.isUndefined(b.which)||_.isEmpty(HS_Search.results)){var c=[9,13,16,17,18,20,32,33,34,37,38,91,93];if(c.indexOf(b.which)>-1)return void HS_Search.log("Ignored key press",b.which);HS_Search.log("Starting search countdown in %d ms",parseInt(GF_HS_Settings.searchDelay,10));var d=a(this);clearTimeout(HS_Search.timeout),HS_Search.timeout=setTimeout(function(){return HS_Search.log("Performing search",b.which),HS_Search.query=d.val(),HS_Search.query.length<GF_HS_Settings.minLength||(8===b.which||46===b.which)&&0===HS_Search.query.length?(HS_Search.cancelled=!0,void HS_Search.set_results({})):void(HS_Search.searching||HS_Search.perform_search())},parseInt(GF_HS_Settings.searchDelay,10))}},perform_search:function(){HS_Search.results={},HS_Search.cancelled=!1,HS_Search.fetch_results(),HS_Search.performed_search++},log:function(a,b){HS_Search.debug&&console&&console.log&&console.log(a,b)},get_results_html:function(){var b="",c=0;return"undefined"!=typeof HS_Search.results.articles&&HS_Search.results.articles.results.length?(HS_Search.form.find(".go-next-step").show(),b=GF_HS_Settings.template.before,a.each(HS_Search.results.articles.results,function(d,e){var f=!0;GF_HS_Settings.collections.length>0&&(f=!1,a.each(GF_HS_Settings.collections,function(a,b){var c=new RegExp("^/docs/"+b);c.exec(e.docsUrl)&&(f=!0)})),c<HS_Search.limit&&f&&(c++,b+=HS_Search.get_article_html(e))}),b+=GF_HS_Settings.template.after):4<=HS_Search.performed_search||"resolved"==HS_Search.has_searched_enough.state()?HS_Search.form.find(".go-next-step").show():HS_Search.form.find(".go-next-step").hide(),HS_Search.get_results_found(c)+b},get_article_html:function(a){var b=GF_HS_Settings.template.item;for(var c in a)a.hasOwnProperty(c)&&(b=b.replace(RegExp("{"+c+"}","g"),a[c]));return b},get_results_found:function(a){var b="",c="results-found";return 0===HS_Search.query.length?(b=GF_HS_Settings.text.enter_search,c+=" message-enter_search"):HS_Search.query.length<HS_Search.minLength?(b=GF_HS_Settings.text.not_long_enough.replace("{minLength}",HS_Search.minLength),c+=" message-minlength"):0===a?(b=GF_HS_Settings.text.no_results_found,c+=" message-no_results"):(b=1===a?GF_HS_Settings.text.result_found:GF_HS_Settings.text.results_found,c+=" message-results"),GF_HS_Settings.template.results_found.replace("{css_class}",c).replace("{text}",b).replace("{count}",a)},set_results:function(a){HS_Search.log("Adding results:",a),HS_Search.results=a,HS_Search.wrap.find(".docs-search-wrap").html(HS_Search.get_results_html()).not(":visible").slideDown()},sanitize_query:function(a){return a=a.replace(/[\{\}\[\]]/g," "),HS_Search.log("Searching for %s",a),a},fetch_results:function(){query=HS_Search.sanitize_query(HS_Search.query),$search_wrap=HS_Search.wrap.find(".docs-search-wrap"),a.ajax({url:"https://"+GF_HS_Settings._subdomain+".helpscoutdocs.com/search/ajax?ref=support&query="+encodeURIComponent(query),async:!0,dataType:"json",beforeSend:function(){HS_Search.searching=!0,$search_wrap.addClass("docs-searching"),HS_Search.wrap.find(".docs-search-wrap").show().html('<span class="gf-hs-spinner"></span>'),a("body").trigger("gf_hs_search_started")},success:function(b){HS_Search.cancelled||(HS_Search.set_results(b),a("body").trigger("gf_hs_search_results_found"),HS_Search.has_searched=!0)},error:function(b){HS_Search.log("Error: %s",b),a("body").trigger("gf_hs_search_error")}}).always(function(){HS_Search.searching=!1,$search_wrap.removeClass("docs-searching")})}})}),jQuery(function(a){_.delay(function(){HS_Search.init()},300)}),jQuery(function(a){_.isUndefined(window.HS)||HS.beacon.ready(function(){a(".entry-content").on("click","a[data-beacon-article]",function(){var b=a(this).attr("data-beacon-article");_.delay(function(){HS.beacon.show(b)},500),_.delay(function(){HS.beacon.show(b)},1e3)})})});